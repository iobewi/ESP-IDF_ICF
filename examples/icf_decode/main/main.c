#include <stdio.h>
#include "icf/icf.h"

const uint8_t sample_capsule[] = {
    0x01, 0x19, 'h','t','t','p','s',':','/','/','b','a','l','a','b','e','w','i','.','o','r','g','/','a','u','d','i','o','1','.','m','p','3',
    0x02, 0x02, 'f','r',
    0x03, 0x10, 'H','i','s','t','o','i','r','e','s',' ','d','e',' ','p','i','r','a','t','e','s',
    0x04, 0x03, 0x01, 0x01, 0x00,
    0x05, 0x01, 0x07,
    0x06, 0x04, 0x69,0x78,0x56,0x00,
    0xF2, 0x20, // hash placeholder (all zeros)
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xF3, 0x40, // signature placeholder
    [0 ... 63] = 0x00,
    0xF4, 0x08, 0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF
};

void app_main(void)
{
    icf_capsule_t cap;
    if (icf_parse(sample_capsule, sizeof(sample_capsule), &cap) == ESP_OK) {
        icf_capsule_print(&cap);
    } else {
        printf("Failed to parse capsule\n");
    }
    icf_capsule_free(&cap);
}
