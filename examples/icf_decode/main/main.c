#include <stdio.h>
#include "icf/icf.h"

const uint8_t sample_capsule[] = {
    0x01, 0x1F, 'h','t','t','p','s',':','/','/','b','a','l','a','b','e','w','i','.','o','r','g','/','a','u','d','i','o','1','.','m','p','3',
    0x02, 0x02, 'f','r',
    0x03, 0x14, 'H','i','s','t','o','i','r','e','s',' ','d','e',' ','p','i','r','a','t','e','s',
    0x04, 0x03, 0x01, 0x01, 0x00,
    0x05, 0x01, 0x07,
    0x06, 0x04, 0x69,0x78,0x56,0x00,
    0xF2, 0x20,
    0xEF,0xA8,0x61,0x05,0x25,0x69,0x8F,0x09,0x72,0xE5,0x5B,0x33,0x57,0x18,0x35,0x49,
    0xBA,0x6F,0x22,0x26,0x59,0x9F,0xD4,0xD0,0x69,0xFC,0x5D,0x91,0x05,0x28,0x42,0x50,
    0xF3, 0x40,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0xF4, 0x08, 0x01,0x23,0x45,0x67,0x89,0xAB,0xCD,0xEF
};

void app_main(void)
{
    icf_capsule_t cap;
    esp_err_t ret = icf_parse(sample_capsule, sizeof(sample_capsule), &cap, false, NULL);
    if (ret == ESP_OK) {
        icf_capsule_print(&cap);
    } else {
        printf("Failed to parse capsule: %d\n", ret);
    }
    icf_capsule_free(&cap);
}
